<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Edit Printer</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; background-color: #f8f9fa; color: #343a40; margin: 0; padding: 2rem; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; margin-top: 0; }
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 1.5rem; }
        label { font-weight: bold; margin-bottom: 5px; display: block; }
        input, select { width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ced4da; box-sizing: border-box; }
        button { cursor: pointer; background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 4px; font-size: 1rem; }
        button:hover { background: #218838; }
        a.button { display: inline-block; background: #6c757d; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; margin-left: 10px; }
        a.button:hover { background: #5a6268; }
        small { color: #6c757d; font-size: 0.85em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Edit Printer: {{ printer.name }}</h1>
        <form method="POST" enctype="multipart/form-data">
            <div class="form-grid">
                <div><label>Printer Name</label><input type="text" name="name" value="{{ printer.name }}" required></div>
                <div><label>Type</label>
                    <select name="type" id="edit-printer-type">
                        <option value="prusa" {% if printer.type == 'prusa' %}selected{% endif %}>Prusa</option>
                        <option value="klipper" {% if printer.type == 'klipper' %}selected{% endif %}>Klipper</option>
                        <option value="bambulab" {% if printer.type == 'bambulab' %}selected{% endif %}>Bambu Lab</option>
                    </select>
                </div>
            </div>
            <div class="type-specific-fields" id="prusa-fields-edit">
                <div class="form-grid">
                    <div><label>IP Address (Local Network)</label><input type="text" name="ip" value="{{ printer.ip or '' }}"></div>
                    <div><label>API Key (From Printer Menu)</label><input type="text" name="api_key" value="{{ printer.api_key or '' }}"></div>
                </div>
            </div>
            <div class="type-specific-fields" id="klipper-fields-edit">
                <div class="form-grid">
                    <div><label>Moonraker/Klipper URL</label><input type="text" name="url" value="{{ printer.url or '' }}"></div>
                </div>
            </div>
            <div class="type-specific-fields" id="bambulab-fields-edit">
                <div class="form-grid">
                    <div><label>IP Address</label><input type="text" name="ip" value="{{ printer.ip or '' }}"></div>
                    <div><label>Access Code</label><input type="text" name="access_code" value="{{ printer.access_code or '' }}"></div>
                    <div><label>Serial Number</label><input type="text" name="serial" value="{{ printer.serial or '' }}"></div>
                </div>
            </div>
            <div class="form-grid" style="margin-top: 1rem;">
                <div><label>Number of Toolheads</label><input type="number" name="toolheads" min="1" value="{{ printer.toolheads | default(1, true) }}"></div>
                <div><label>Image URL (Optional)</label><input type="text" name="image_url" value="{{ printer.image_url or '' }}" placeholder="https://.../image.png"></div>
                <div>
                    <label>Or Upload New Image (Optional)</label>
                    <input type="file" name="image_file" accept="image/*">
                    <small>Current file: <strong>{{ printer.get('local_image_filename', 'None') }}</strong>. Overrides URL.</small>
                </div>
                <div>
                    <label><input type="checkbox" name="show_filename" {% if printer.show_filename != False %}checked{% endif %}> Display File Name</label>
                </div>
            </div>
            <div style="margin-top: 2rem;">
                <button type="submit">Save Changes</button>
                <a href="{{ url_for('admin') }}" class="button">Cancel</a>
            </div>
        </form>
    </div>
    <script>
        function handleEditFormDisplay() {
            const type = document.getElementById('edit-printer-type').value;
            document.querySelectorAll('.type-specific-fields').forEach(div => {
                div.style.display = 'none';
                div.querySelectorAll('input').forEach(input => input.disabled = true);
            });
            const fieldsToShow = document.getElementById(type + '-fields-edit');
            if (fieldsToShow) {
                fieldsToShow.style.display = 'block';
                fieldsToShow.querySelectorAll('input').forEach(input => input.disabled = false);
            }
        }
        document.getElementById('edit-printer-type').addEventListener('change', handleEditFormDisplay);
        handleEditFormDisplay(); // Initial call
    </script>
</body>
</html>
